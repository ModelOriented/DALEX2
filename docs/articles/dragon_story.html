<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dragon story • DALEX2</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top navbar-mi2" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-mi2logo" href="http://mi2.mini.pw.edu.pl/">
        <img src="https://github.com/mi2-warsaw/MI2template/blob/master/inst/pkgdown/assets/MI2logo.jpg?raw=true" alt="MI2" height="46" title="MI2"></a>
      <a class="navbar-brand navbar-mi2" href="../index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="navbar-mi2 nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/dragon_story.html">Dragon story</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Dragon story</h1>
                        <h4 class="author">Agnieszka Ciepielewska</h4>
            
            <h4 class="date">2019-01-08</h4>
      
      
      <div class="hidden name"><code>dragon_story.Rmd</code></div>

    </div>

    
    

<p>Once upon a time, there lived mighty dragons. With large teeth and strong jaws, they were a threat to all other species. Since the 18<span class="math inline">\(^{\mathrm{th}}\)</span> century archaeologists were discovering bones of those creatures. Based on their remains, they knew quite a lot about them. It was easy to measure the dragon’s height and approximate weight. They also knew how many scars they’d had or how many teeth they’d lost. The remains of the scales gave information about the colour of the dragon. Based on <span class="math inline">\(^{14}\)</span>C dating they could even tell when the dragon was born. But they wanted to know how long the dragon lived, which was a bit problematic. Luckily, in the old records, the date of death for several dragons could be found.</p>
<p>Each variable influences the target in a different way (fig. 1). Both scars and the number of lost teeth have a linear relation to the life length. The older the dragon was the more scars and fewer teeth he had. Due to heroic quests accomplished by knights, the dragons born in the middle ages lived much shorter than in other periods. As for height, the relation is more complicated. The smallest dragons were quite good at hiding themselves and therefore could live longer. Similarly, the largest dragons were difficult to kill because of their size and power. Overall the relation between height and length of life is quadratic. There is, however, one more interesting catch regarding dragons height. Around 1840 people discovered a new island and found a new breed of dragon. The exceptionally large black dragon, which lived ages because of no natural enemies. The relation stays the same, but the distribution of the height of the dragons is shifted.</p>
<p>Long live the dragons!</p>
<p style="text-align:center;">
<img src="dragons_diagram.svg" alt="diagram"><br><br>Figure 1: Diagram of relations between the variables
</p>

<p>The data is generated with following code:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">true_model &lt;-<span class="st"> </span><span class="cf">function</span>(model, data){</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">  <span class="kw">return</span>(<span class="kw">abs</span>(<span class="dv">500</span> <span class="op">+</span><span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span>(<span class="kw">abs</span>(data<span class="op">$</span>year_of_birth <span class="op">-</span><span class="st"> </span><span class="dv">1000</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">500</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="st">               </span><span class="fl">0.02</span> <span class="op">*</span><span class="st"> </span>(data<span class="op">$</span>height <span class="op">-</span><span class="st"> </span><span class="dv">50</span>)<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">40</span> <span class="op">*</span><span class="st"> </span>data<span class="op">$</span>scars <span class="op">+</span><span class="st"> </span><span class="dv">20</span> <span class="op">*</span><span class="st"> </span>data<span class="op">$</span>number_of_lost_teeth))</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1-6" data-line-number="6">N &lt;-<span class="st"> </span><span class="dv">2000</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw">set.seed</span>(<span class="dv">756</span>)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1-9" data-line-number="9">year_of_birth &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">runif</span>(N, <span class="dv">-2000</span>, <span class="dv">1800</span>)) <span class="co"># year, for negative -n = n + 1 BC</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10">year_of_discovery &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">round</span>(<span class="kw">runif</span>(N, <span class="dv">1700</span>, <span class="dv">1800</span>))) <span class="co"># year</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11">height &lt;-<span class="st"> </span><span class="kw">rgamma</span>(N, <span class="dv">50</span>) <span class="co"># yards</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12">weight &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">4</span> <span class="op">*</span><span class="st"> </span>height <span class="op">+</span><span class="st"> </span><span class="kw">rexp</span>(N, <span class="dv">1</span>) <span class="co"># tons</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13">scars &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">rexp</span>(N, <span class="fl">0.1</span>)) <span class="co"># number</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14">number_of_lost_teeth &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">runif</span>(N, <span class="dv">0</span>, <span class="dv">40</span>)) <span class="co"># number</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15">colour &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">'red'</span>, <span class="st">'blue'</span>, <span class="st">'green'</span>, <span class="st">'black'</span>), N, <span class="dt">replace=</span><span class="ot">TRUE</span>, <span class="dt">p=</span><span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">0.3</span>, <span class="fl">0.18</span>, <span class="fl">0.02</span>))</a>
<a class="sourceLine" id="cb1-16" data-line-number="16">life_length &lt;-<span class="st"> </span><span class="kw">true_model</span>(<span class="ot">NULL</span>, <span class="kw">data.frame</span>(year_of_birth, height, weight,</a>
<a class="sourceLine" id="cb1-17" data-line-number="17">                                           scars, colour, year_of_discovery,</a>
<a class="sourceLine" id="cb1-18" data-line-number="18">                                           number_of_lost_teeth)) <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(N, <span class="dv">0</span>, <span class="dv">20</span>)</a>
<a class="sourceLine" id="cb1-19" data-line-number="19">dragons &lt;-<span class="st"> </span><span class="kw">data.frame</span>(year_of_birth, height, weight, scars, colour,</a>
<a class="sourceLine" id="cb1-20" data-line-number="20">                 year_of_discovery, number_of_lost_teeth, life_length)</a>
<a class="sourceLine" id="cb1-21" data-line-number="21"></a>
<a class="sourceLine" id="cb1-22" data-line-number="22">N &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23"><span class="kw">set.seed</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1-24" data-line-number="24"></a>
<a class="sourceLine" id="cb1-25" data-line-number="25">year_of_birth &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">runif</span>(N, <span class="dv">-2000</span>, <span class="dv">2000</span>)) <span class="co"># year, for negative -n = n + 1 BC</span></a>
<a class="sourceLine" id="cb1-26" data-line-number="26">year_of_discovery &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">round</span>(<span class="kw">runif</span>(N, <span class="dv">1800</span>, <span class="dv">2000</span>))) <span class="co"># year</span></a>
<a class="sourceLine" id="cb1-27" data-line-number="27">colour &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">'red'</span>, <span class="st">'blue'</span>, <span class="st">'green'</span>, <span class="st">'black'</span>), N, <span class="dt">replace=</span><span class="ot">TRUE</span>, <span class="dt">p=</span><span class="kw">c</span>(<span class="fl">0.4</span>, <span class="fl">0.3</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>))</a>
<a class="sourceLine" id="cb1-28" data-line-number="28">height &lt;-<span class="st"> </span><span class="kw">ifelse</span>(</a>
<a class="sourceLine" id="cb1-29" data-line-number="29">  colour <span class="op">==</span><span class="st"> 'black'</span> <span class="op">&amp;</span><span class="st"> </span>year_of_discovery <span class="op">&gt;</span><span class="st"> </span><span class="dv">1840</span>,</a>
<a class="sourceLine" id="cb1-30" data-line-number="30">  <span class="kw">rgamma</span>(N, <span class="dv">200</span>),</a>
<a class="sourceLine" id="cb1-31" data-line-number="31">  <span class="kw">rgamma</span>(N, <span class="dv">50</span>)</a>
<a class="sourceLine" id="cb1-32" data-line-number="32">) <span class="co"># yards</span></a>
<a class="sourceLine" id="cb1-33" data-line-number="33">weight &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">4</span> <span class="op">*</span><span class="st"> </span>height <span class="op">+</span><span class="st"> </span><span class="kw">rexp</span>(N, <span class="dv">1</span>) <span class="co"># tons</span></a>
<a class="sourceLine" id="cb1-34" data-line-number="34">scars &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">rexp</span>(N, <span class="fl">0.1</span>)) <span class="co"># number</span></a>
<a class="sourceLine" id="cb1-35" data-line-number="35">number_of_lost_teeth &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">runif</span>(N, <span class="dv">0</span>, <span class="dv">40</span>)) <span class="co"># number</span></a>
<a class="sourceLine" id="cb1-36" data-line-number="36">life_length &lt;-<span class="st"> </span><span class="kw">true_model</span>(<span class="ot">NULL</span>, <span class="kw">data.frame</span>(year_of_birth, height, weight,</a>
<a class="sourceLine" id="cb1-37" data-line-number="37">                                           scars, colour, year_of_discovery,</a>
<a class="sourceLine" id="cb1-38" data-line-number="38">                                           number_of_lost_teeth)) <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(N, <span class="dv">0</span>, <span class="dv">20</span>)</a>
<a class="sourceLine" id="cb1-39" data-line-number="39">dragons_test &lt;-<span class="st"> </span><span class="kw">data.frame</span>(year_of_birth, height, weight, scars, colour,</a>
<a class="sourceLine" id="cb1-40" data-line-number="40">                           year_of_discovery, number_of_lost_teeth, life_length)</a></code></pre></div>
<p>Head of the data:</p>
<pre><code>##   year_of_birth   height   weight scars colour year_of_discovery
## 1         -1291 59.40365 15.32391     7    red              1700
## 2          1589 46.21374 11.80819     5    red              1700
## 3          1528 49.17233 13.34482     6    red              1700
## 4          1645 48.29177 13.27427     5  green              1700
## 5            -8 49.99679 13.08757     1    red              1700
## 6           915 45.40876 11.48717     2    red              1700
##   number_of_lost_teeth life_length
## 1                   25   1368.4331
## 2                   28   1377.0474
## 3                   38   1603.9632
## 4                   33   1434.4222
## 5                   18    985.4905
## 6                   20    969.5682</code></pre>
<p>Example model on the data:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">library</span>(<span class="st">"randomForest"</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">rf_model &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/randomForest/topics/randomForest">randomForest</a></span>(life_length <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> dragons)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">rf_model</a></code></pre></div>
<pre><code>## 
## Call:
##  randomForest(formula = life_length ~ ., data = dragons) 
##                Type of random forest: regression
##                      Number of trees: 500
## No. of variables tried at each split: 2
## 
##           Mean of squared residuals: 10362.46
##                     % Var explained: 95.29</code></pre>
<p>Explainer for the model:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">ef_explain &lt;-<span class="st"> </span><span class="kw"><a href="../reference/explain.html">explain</a></span>(rf_model, <span class="dt">data =</span> dragons, </a>
<a class="sourceLine" id="cb5-2" data-line-number="2">                      <span class="dt">y =</span> dragons<span class="op">$</span>life_length, <span class="dt">label =</span> <span class="st">"RF"</span>)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">ef_explain</a></code></pre></div>
<pre><code>## Model label:  RF 
## Model class:  randomForest.formula,randomForest 
## Data head  :
##   year_of_birth   height   weight scars colour year_of_discovery
## 1         -1291 59.40365 15.32391     7    red              1700
## 2          1589 46.21374 11.80819     5    red              1700
##   number_of_lost_teeth life_length
## 1                   25    1368.433
## 2                   28    1377.047</code></pre>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Przemyslaw Biecek.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
